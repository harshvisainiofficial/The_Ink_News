<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}द इंक न्यूज़{% endblock %}</title>
    <!-- Open Graph Meta Tags for Link Preview -->
    <meta property="og:site_name" content="द इंक न्यूज़">
    <meta property="og:type" content="website">
    {% if news %}
        <meta property="og:title" content="{{ news.title | safe }}">
        {# Find the first image block #}
        {% set first_image = None %}
        {% set first_video = None %}
        {% for block in news.content_blocks %}
            {% if not first_image and block.block_type == 'image' %}
                {% set first_image = block %}
            {% endif %}
            {% if not first_video and block.block_type == 'video' %}
                {% set first_video = block %}
            {% endif %}
        {% endfor %}
        {% if first_image %}
            <meta property="og:image" content="{{ first_image.content | safe }}">
        {% elif first_video %}
            <meta property="og:image" content="{{ first_video.content | safe }}">
        {% else %}
            <meta property="og:image" content="https://res.cloudinary.com/dmvfrdzrl/image/upload/v1752772701/SharedUploads/ink-news-logo.png?f_auto,q_auto">
        {% endif %}
    {% else %}
        <meta property="og:title" content="द इंक न्यूज़">
        <meta property="og:image" content="https://res.cloudinary.com/dmvfrdzrl/image/upload/v1752772701/SharedUploads/ink-news-logo.png?f_auto,q_auto">
    {% endif %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body>
    <header>
        <div class="top-ad">
            {% if ad and ad.top_banner %}
                <img src="{{ ad.top_banner }}" alt="Top Banner Ad" style="max-width: 100%;">
            {% else %}
                <p>यहां विज्ञापन दिखाएं</p>
            {% endif %}
        </div>
        <div class="header-main">
            <div class="mobile-nav-toggle" id="mobile-nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="logo" style="display: flex; align-items: center;">
                <img src="https://res.cloudinary.com/dmvfrdzrl/image/upload/v1752772701/SharedUploads/ink-news-logo.png?f_auto,q_auto" alt="The Ink NEWS Logo" style="max-width: 150px; height: auto; display: block; margin: 0 auto;">
                <h1 style="margin: 0;" class="site-title">द इंक न्यूज़</h1>
            </div>
            <nav class="top-nav">
                <ul>
                    <li><a href="{{ url_for('index') }}" {% if not selected_category %}class="active"{% endif %}>होम</a></li>
                    <li><a href="{{ url_for('video') }}">वीडियो</a></li>
                    <li><a href="{{ url_for('search') }}">खोज</a></li>
                    <li><a href="{{ url_for('epaper') }}">ई-पेपर</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="left-nav-toggle" id="left-nav-toggle">
        <span></span>
        <span></span>
        <span></span>
    </div>
    <div class="left-nav-overlay" id="left-nav-overlay"></div>
    <div class="main-container">
        <aside class="left-nav" id="left-nav">
            <button class="close-nav" id="close-nav">✕</button>
            <ul>
                <li><a href="{{ url_for('live_news') }}">लाइव न्यूज़</a></li>
                <li><a href="{{ url_for('category', category='top-news') }}">टॉप न्यूज़</a></li>
                <li>
                    <div style="display: flex; align-items: center; padding: 10px; border-bottom: 1px solid #eee;">
                        <a href="{{ url_for('rajya_shehar') }}" style="flex: 1;">राज्य शहर</a>
                        <select onchange="if(this.value) window.location.href='{{ url_for('rajya_shehar') }}?city=' + encodeURIComponent(this.value)" style="margin-left: 10px; padding: 5px; font-size: 14px; border: 1px solid #eee; border-radius: 4px; width: 120px;">
                            <option value="">सभी शहर</option>
                            {% for city in cities %}
                                <option value="{{ city }}" {% if city == selected_city %}selected{% endif %}>{{ city }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </li>
                <li><a href="{{ url_for('category', category='the-ink-khas') }}">द इंक खास</a></li>
                <li><a href="{{ url_for('category', category='cricket') }}">क्रिकेट</a></li>
                <li><a href="{{ url_for('category', category='sports') }}">खेल</a></li>
                <li><a href="{{ url_for('category', category='jiveen-mantra') }}">जीवन मंत्र</a></li>
                <li><a href="{{ url_for('category', category='business') }}">व्यापार</a></li>
            </ul>
        </aside>

        <main class="content">
            {% block content %}
                <section class="news-articles">
                    {% if news_articles %}
                        {% for article in news_articles %}
                            <article>
                                <div class="article-header">
                                    <h3>{{ article.title }}</h3>
                                    <a href="#" class="share-icon" data-url="{{ url_for('article', id=article.id, _external=True) }}" title="Share this article">↗</a>
                                </div>
                                {% if article.content_blocks %}
                                    {% for block in article.content_blocks %}
                                        {% if block.block_type == 'image' %}
                                            <img src="{{ block.content }}" alt="{{ article.title }}" class="news-image">
                                        {% endif %}
                                    {% endfor %}
                                    {% for block in article.content_blocks %}
                                        {% if block.block_type == 'text' %}
                                            <p>{{ block.content | safe }}</p>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                                <a href="{{ url_for('article', id=article.id) }}" class="read-more">और पढ़ें</a>
                            </article>
                        {% endfor %}
                    {% else %}
                        <p>कोई लेख उपलब्ध नहीं है। कृपया डेटाबेस में 'head_approved=True' लेखों की जाँच करें।</p>
                    {% endif %}
                </section>
            {% endblock %}
        </main>

        <aside class="right-ad">
            {% if ad and ad.right_sidebar %}
                <img src="{{ ad.right_sidebar }}" alt="Right Sidebar Ad" style="max-width: 100%;">
            {% else %}
                <p>यहां विज्ञापन दिखाएं</p>
            {% endif %}
        </aside>
    </div>

    <div class="floating-logo">
        <img src="https://res.cloudinary.com/dmvfrdzrl/image/upload/v1752772701/SharedUploads/ink-news-logo.png?f_auto,q_auto" alt="The Ink NEWS Floating Logo">
    </div>

    <!-- Share Pop-up -->
    <div class="share-popup" id="share-popup" style="display: none;">
        <div class="share-popup-content">
            <button class="close-popup" id="close-popup">✕</button>
            <h3>लिंक साझा करें</h3>
            <input type="text" id="share-link" readonly>
            <button id="copy-link">लिंक कॉपी करें</button>
            <a id="whatsapp-share" href="#" target="_blank" class="whatsapp-btn">WhatsApp पर साझा करें</a>
        </div>
    </div>

    <footer>
        <p>© 2025 द इंक न्यूज़. सर्वाधिकार सुरक्षित।</p>
    </footer>

    <script>
        // Navigation Toggles
        const mobileNavToggle = document.getElementById('mobile-nav-toggle');
        const leftNavToggle = document.getElementById('left-nav-toggle');
        const topNav = document.querySelector('.top-nav');
        const leftNav = document.getElementById('left-nav');
        const leftNavOverlay = document.getElementById('left-nav-overlay');
        const closeNav = document.getElementById('close-nav');

        mobileNavToggle.addEventListener('click', function() {
            topNav.classList.toggle('active');
            this.classList.toggle('active');
            leftNav.classList.remove('active');
            leftNavOverlay.classList.remove('active');
            leftNavToggle.classList.remove('active');
        });

        leftNavToggle.addEventListener('click', function() {
            leftNav.classList.toggle('active');
            leftNavOverlay.classList.toggle('active');
            this.classList.toggle('active');
            topNav.classList.remove('active');
            mobileNavToggle.classList.remove('active');
        });

        leftNavOverlay.addEventListener('click', function() {
            leftNav.classList.remove('active');
            leftNavOverlay.classList.remove('active');
            leftNavToggle.classList.remove('active');
        });

        closeNav.addEventListener('click', function() {
            leftNav.classList.remove('active');
            leftNavOverlay.classList.remove('active');
            leftNavToggle.classList.remove('active');
        });

        document.addEventListener('click', function(event) {
            if (!topNav.contains(event.target) && !mobileNavToggle.contains(event.target)) {
                topNav.classList.remove('active');
                mobileNavToggle.classList.remove('active');
            }
            if (!leftNav.contains(event.target) && !leftNavToggle.contains(event.target) && !leftNavOverlay.contains(event.target)) {
                leftNav.classList.remove('active');
                leftNavOverlay.classList.remove('active');
                leftNavToggle.classList.remove('active');
            }
        });

        // Share Pop-up Logic
        const shareIcons = document.querySelectorAll('.share-icon');
        const sharePopup = document.getElementById('share-popup');
        const shareLinkInput = document.getElementById('share-link');
        const copyLinkButton = document.getElementById('copy-link');
        const whatsappShareButton = document.getElementById('whatsapp-share');
        const closePopupButton = document.getElementById('close-popup');

        shareIcons.forEach(icon => {
            icon.addEventListener('click', function(event) {
                event.preventDefault();
                const url = this.getAttribute('data-url');
                shareLinkInput.value = url;
                // Set WhatsApp share link with pre-filled message
                const encodedUrl = encodeURIComponent(url);
                const message = encodeURIComponent('Check out this news article: ');
                whatsappShareButton.href = `https://api.whatsapp.com/send?text=${message}${encodedUrl}`;
                sharePopup.style.display = 'flex';
            });
        });

        copyLinkButton.addEventListener('click', function() {
            shareLinkInput.select();
            document.execCommand('copy');
            alert('लिंक कॉपी हो गया है!');
        });

        closePopupButton.addEventListener('click', function() {
            sharePopup.style.display = 'none';
        });

        sharePopup.addEventListener('click', function(event) {
            if (event.target === sharePopup) {
                sharePopup.style.display = 'none';
            }
        });
    </script>
</body>
</html>